---
- name: Checking if a previous cluster exists
  stat:
    path: "/etc/ceph/{{ ceph_cluster_name }}-monmap"
  register: existing_cluster

- name: Bootstraping Ceph Mon
  docker:
    net: host
    volumes: /etc/ceph:/etc/ceph
    state: running
    image: "{{ docker_registry  }}/yaodu/ceph"
    env: "INITIAL_CLUSTER=true,MON_NAME={{ ansible_hostname }},MON_IP={{ ansible_br_stor['ipv4']['address'] }}"
    command: "/opt/ceph/mon.sh"
    name: "ceph_mon"
  run_once: true
  when: not existing_cluster.stat.exists

- name: Reloading Ceph Mons
  docker:
    net: host
    volumes: /etc/ceph:/etc/ceph
    state: running
    image: "{{ docker_registry  }}/yaodu/ceph"
    env: "MON_NAME={{ ansible_hostname }},MON_IP={{ ansible_br_stor['ipv4']['address'] }}"
    command: "/opt/ceph/mon.sh"
    name: "ceph_mon"
  when: ceph_conf.changed
