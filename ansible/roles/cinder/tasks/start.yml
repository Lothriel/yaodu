---
- name: Starting Cinder Api
  docker:
    name: "cinder-api"
    image: "{{ docker_registry }}/yaodu/cinder"
    state: "running"
    ports: "{{ ansible_br_mgmt['ipv4']['address'] }}:8776:8776"
    expose: "8776"
    volumes: "/opt/yaodu/cinder/:/etc/cinder/"
    env: "SERVICE=api"
    command: "/entrypoint.sh"

- name: Starting Cinder Scheduler
  docker:
    name: "cinder-scheduler"
    image: "{{ docker_registry }}/yaodu/cinder"
    state: "running"
    volumes: "/opt/yaodu/cinder/:/etc/cinder/"
    hostname: "{{ ansible_hostname }}"
    env: "SERVICE=scheduler"
    command: "/entrypoint.sh"

- name: Starting Cinder Volume
  docker:
    name: "cinder-volume"
    image: "{{ docker_registry }}/yaodu/cinder"
    state: "running"
    volumes: "/opt/yaodu/cinder/:/etc/cinder/,/opt/yaodu/cinder/ceph.conf:/etc/ceph/ceph.conf,/opt/yaodu/cinder/ceph.client.cinder.keyring:/etc/ceph/ceph.client.cinder.keyring"
    hostname: "cinder-volume"
    env: "SERVICE=volume"
    command: "/entrypoint.sh"

