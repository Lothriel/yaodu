---
- name: Starting Mariadb
  docker:
    name: "mariadb"
    image: "{{ docker_registry }}/yaodu/mariadb"
    state: "running"
    ports: "{{ ansible_br_mgmt['ipv4']['address'] }}:3306:3306,{{ ansible_br_mgmt['ipv4']['address'] }}:4444:4444,{{ ansible_br_mgmt['ipv4']['address'] }}:4567:4567,{{ ansible_br_mgmt['ipv4']['address'] }}:4568:4568"
    expose: "3306,4444,4567,4568"
    volumes: "/opt/yaodu/mariadb/galera.cnf:/etc/mysql/conf.d/galera.cnf,/opt/yaodu/mariadb/data/:/var/lib/mysql/"
    env: "BOOTSTRAP=true,DATABASE_ROOT_PASSWORD={{ database_root_password }}"
    command: "/entrypoint.sh"

- name: Sleeping while server bootstraps
  local_action: command sleep 15
