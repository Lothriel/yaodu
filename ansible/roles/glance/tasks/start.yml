---
- name: Starting Glance Registry
  docker:
    name: "glance-registry"
    image: "{{ docker_registry }}/yaodu/glance"
    state: "running"
    ports: "{{ ansible_br_mgmt['ipv4']['address'] }}:9191:9191"
    expose: "9191"
    volumes: "/opt/yaodu/glance/:/etc/glance/:ro"
    env: "SERVICE=registry"
    command: "/entrypoint.sh"

- name: Starting Glance Api
  docker:
    name: "glance-api"
    image: "{{ docker_registry }}/yaodu/glance"
    state: "running"
    ports: "{{ ansible_br_mgmt['ipv4']['address'] }}:9292:9292"
    expose: "9292"
    volumes: "/opt/yaodu/ceph/{{ ceph_cluster_name }}.client.glance.keyring:/etc/ceph/{{ ceph_cluster_name }}.client.glance.keyring:ro,/opt/yaodu/ceph/{{ ceph_cluster_name }}.conf,/etc/ceph/{{ ceph_cluster_name }}.conf,/opt/yaodu/glance/:/etc/glance/"
    env: "SERVICE=api"
    command: "/entrypoint.sh"
